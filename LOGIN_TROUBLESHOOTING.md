# Устранение проблем со входом

## Проблема: Вход не работает

### Возможные причины и решения:

#### 1. API не запущен или недоступен

**Проверка:**
- Откройте консоль браузера (F12 → Console)
- Проверьте ошибки сети (F12 → Network)
- Попробуйте открыть `http://ваш-домен/api/health` в браузере

**Решение:**
- Убедитесь, что API запущен на сервере: `pm2 list` или `systemctl status gogomarket-api`
- Проверьте, что API слушает правильный порт (3001)
- Проверьте Nginx конфигурацию (должен проксировать `/api/` на `127.0.0.1:3001`)

#### 2. Неправильный URL API

**Проверка:**
- На странице входа внизу показывается текущий API URL
- Проверьте, что он правильный

**Решение:**
- Если используете `VITE_API_URL` в `.env` — убедитесь, что он задан правильно
- Если не задан — должен автоматически использоваться `origin + /api`
- Для продакшена: `VITE_API_URL=http://134.122.77.41/api` или `VITE_API_URL=https://ваш-домен/api`

#### 3. CORS ошибки

**Проверка:**
- В консоли браузера могут быть ошибки CORS
- Проверьте заголовки ответа от API

**Решение:**
- Убедитесь, что на бэкенде настроен CORS для вашего домена
- Проверьте `server/src/main.ts` — должен быть `app.enableCors()`

#### 4. Проблемы с базой данных

**Проверка:**
- Проверьте логи API: `pm2 logs gogomarket-api`
- Проверьте подключение к БД

**Решение:**
- Убедитесь, что PostgreSQL запущен: `docker ps` или `systemctl status postgresql`
- Проверьте `DATABASE_URL` в `.env` на сервере
- Проверьте, что пользователь создан в БД (seed пользователь: `admin@gogomarket.local` / `GogoAdmin123`)

#### 5. Проблемы с JWT

**Проверка:**
- Проверьте, что `JWT_SECRET` задан в `.env` на сервере (минимум 32 символа)
- Проверьте логи API на ошибки JWT

**Решение:**
- Убедитесь, что `JWT_SECRET` задан и достаточно длинный
- Перезапустите API после изменения `.env`

## Тестовые данные

Для тестирования можно использовать seed пользователя:
- **Email:** `admin@gogomarket.local`
- **Пароль:** `GogoAdmin123`
- **Роль:** ADMIN

Или зарегистрировать нового пользователя через форму регистрации.

## Отладка

1. **Откройте консоль браузера** (F12)
2. **Попробуйте войти** и посмотрите на ошибки
3. **Проверьте Network tab** — какой запрос отправляется и какой ответ приходит
4. **Проверьте логи API** на сервере: `pm2 logs gogomarket-api`

## Быстрая проверка API

```bash
# Проверка health endpoint
curl http://134.122.77.41/api/health

# Проверка логина (замените email и password)
curl -X POST http://134.122.77.41/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@gogomarket.local","password":"GogoAdmin123"}'
```

## Контакты для помощи

Если проблема не решается:
1. Проверьте логи GitHub Actions (деплой)
2. Проверьте логи Nginx: `sudo tail -f /var/log/nginx/error.log`
3. Проверьте логи API: `pm2 logs gogomarket-api`
