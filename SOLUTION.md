# Решение проблемы 502 Bad Gateway

## Проблема
API возвращает 502 Bad Gateway, хотя workflow выполняются успешно.

## Причина
Workflow выполняют проверки, которые проходят успешно, но API либо не запускается, либо падает сразу после проверки.

## Решение

Выполните на сервере следующую команду для диагностики и исправления:

```bash
curl -sSL https://raw.githubusercontent.com/buranovt2025-jpg/gogotest/main/server/deploy/fix-and-start.sh | bash
```

Этот скрипт:
1. Остановит старый процесс API
2. Проверит наличие необходимых файлов
3. Установит зависимости если нужно
4. Запустит API через PM2
5. Проверит работоспособность с подробными логами ошибок

## Альтернатива: диагностика

Если скрипт не помогает, выполните диагностику:

```bash
curl -sSL https://raw.githubusercontent.com/buranovt2025-jpg/gogotest/main/server/deploy/diagnose.sh | bash
```

Это покажет:
- Статус PM2 и процесса API
- Слушается ли порт 3001
- Последние логи API (50 строк)
- Работает ли health endpoint
- Существуют ли необходимые файлы

## Что уже исправлено в коде

1. ✅ Циклическая зависимость исправлена через `forwardRef()` в `auth.module.ts` и `users.module.ts`
2. ✅ Создан скрипт `fix-and-start.sh` для автоматического исправления
3. ✅ Создан скрипт `diagnose.sh` для диагностики
4. ✅ Workflow автоматически применяют код с исправлениями

## Следующие шаги

После выполнения скрипта проверьте:
```bash
curl http://134.122.77.41/api/health
```

Если проблема сохраняется, проверьте логи:
```bash
pm2 logs gogomarket-api --lines 50
```
