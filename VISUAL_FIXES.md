# Исправления визуальных проблем на хостинге

## Проблемы и решения

### 1. CSS и JS файлы не загружаются

**Проблема:** После деплоя стили и скрипты не применяются, страница выглядит "голой".

**Причина:** 
- Неправильная конфигурация путей в Vite
- Nginx не правильно раздаёт статические файлы

**Решение:**
- ✅ Обновлён `vite.config.ts` с явным указанием `base: '/'` и настройками `assetsDir`
- ✅ Обновлён `deploy/nginx-default-with-api.conf` с правильной обработкой статических файлов

### 2. Шрифты Google Fonts не загружаются

**Проблема:** Текст отображается системным шрифтом вместо DM Sans.

**Причина:** 
- Блокировка внешних ресурсов
- Проблемы с CORS

**Решение:**
- В `index.html` уже есть `preconnect` для Google Fonts
- Если проблема сохраняется, можно добавить fallback шрифты в CSS:
  ```css
  font-family: 'DM Sans', system-ui, -apple-system, sans-serif;
  ```

### 3. Статические файлы (manifest.json, robots.txt) не доступны

**Проблема:** PWA не работает, поисковики не индексируют сайт.

**Причина:** 
- Файлы из `public/` не копируются при сборке
- Nginx не правильно обрабатывает эти файлы

**Решение:**
- ✅ В `vite.config.ts` добавлен `publicDir: 'public'`
- ✅ В Nginx добавлена отдельная секция для manifest.json, robots.txt, sitemap.xml

### 4. Пути к ресурсам неправильные

**Проблема:** Изображения, CSS, JS загружаются с неправильных путей.

**Причина:** 
- Vite генерирует пути относительно корня, но сервер ожидает другие пути

**Решение:**
- ✅ В `vite.config.ts` явно указан `base: '/'`
- ✅ Настроены `rollupOptions` для правильного именования файлов

## Что нужно сделать после изменений

1. **Пересобрать проект:**
   ```bash
   npm run build
   ```

2. **Проверить структуру dist/:**
   ```bash
   ls -la dist/
   ls -la dist/assets/
   ```
   
   Должны быть:
   - `index.html`
   - `assets/` (с CSS и JS файлами)
   - `manifest.json`
   - `robots.txt`
   - `sitemap.xml`

3. **Закоммитить и запушить изменения:**
   ```bash
   git add vite.config.ts deploy/nginx-default-with-api.conf VISUAL_FIXES.md
   git commit -m "fix: исправлены пути к статическим файлам и конфигурация Nginx"
   git push origin main
   ```

4. **После деплоя проверить:**
   - Открыть http://134.122.77.41 в браузере
   - Открыть DevTools (F12) → Network
   - Проверить, что все файлы загружаются с кодом 200:
     - `/assets/*.css` (стили)
     - `/assets/*.js` (скрипты)
     - `/manifest.json`
     - `/robots.txt`
   - Проверить Console на наличие ошибок

## Дополнительные проверки

### Проверка в браузере (DevTools)

1. **Console:**
   - Не должно быть ошибок типа "Failed to load resource"
   - Не должно быть ошибок типа "Refused to load stylesheet"

2. **Network:**
   - Все запросы к `/assets/*` должны возвращать 200
   - `manifest.json` должен возвращать 200
   - Google Fonts должны загружаться (или быть заблокированными, но это не критично)

3. **Elements:**
   - Проверить, что `<link rel="stylesheet">` указывает на правильный путь
   - Проверить, что `<script>` указывает на правильный путь

### Проверка на сервере

```bash
ssh root@134.122.77.41

# Проверить структуру файлов
ls -la /var/www/html/
ls -la /var/www/html/assets/

# Проверить права доступа
chmod -R 755 /var/www/html

# Проверить конфигурацию Nginx
sudo nginx -t

# Перезагрузить Nginx
sudo systemctl reload nginx
```

## Если проблема сохраняется

1. **Проверить логи Nginx:**
   ```bash
   sudo tail -f /var/log/nginx/error.log
   ```

2. **Проверить, что файлы действительно загружены:**
   ```bash
   ls -la /var/www/html/assets/
   cat /var/www/html/index.html | grep -E '(href|src)'
   ```

3. **Проверить базовый путь в собранном index.html:**
   - Открыть `/var/www/html/index.html`
   - Убедиться, что пути к CSS/JS начинаются с `/assets/` или `/`

4. **Проверить Content-Type заголовки:**
   ```bash
   curl -I http://134.122.77.41/assets/index.css
   ```
   Должен вернуть `Content-Type: text/css`

## Контакты для отладки

Если проблема не решается:
1. Проверить логи GitHub Actions (деплой)
2. Проверить логи Nginx на сервере
3. Проверить консоль браузера на наличие ошибок
4. Убедиться, что все файлы из `dist/` загружены на сервер
