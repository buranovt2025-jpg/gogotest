# Пример конфигурации Alertmanager для алертов GogoMarket.
# Запуск: alertmanager --config.file=alertmanager.example.yml
# В prometheus.yml задать: alerting: alertmanagers: [{ static_configs: [{ targets: ['localhost:9093'] }] }]

global:
  # resolve_timeout: 5m

route:
  receiver: default
  group_by: ['alertname', 'job']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  routes:
    # Критичные алерты (GogoMarketDown) — можно направить в отдельный канал
    - match:
        severity: critical
      receiver: default
      # continue: true  # отправить также в default
    # Предупреждения (GogoMarketHighRequestRate)
    - match:
        severity: warning
      receiver: default

receivers:
  - name: default
    # Без настроенных каналов алерты только группируются. Раскомментируйте один из блоков ниже.

  # --- Slack: создайте Incoming Webhook (Slack App → Incoming Webhooks), вставьте URL и канал ---
  # - name: slack-alerts
  #   slack_configs:
  #     - api_url: 'https://hooks.slack.com/services/YOUR_WORKSPACE/YOUR_CHANNEL/YOUR_WEBHOOK_ID'
  #       channel: '#alerts'
  #       title: '{{ .GroupLabels.alertname }}'
  #       text: '{{ range .Alerts }}{{ .Annotations.summary }}: {{ .Annotations.description }}{{ end }}'
  #       send_resolved: true
  # В route.routes замените receiver: default на receiver: slack-alerts для critical/warning.

  # --- Telegram: создайте бота через @BotFather, получите chat_id (напишите боту, откройте https://api.telegram.org/bot<TOKEN>/getUpdates) ---
  # - name: telegram-alerts
  #   webhook_configs:
  #     - url: 'https://api.telegram.org/bot<BOT_TOKEN>/sendMessage'
  #       send_resolved: true
  #       http_config:
  #         bearer_token: ''
  # Alertmanager не шлёт JSON в Telegram напрямую; используйте промежуточный сервис (например prometheus-bot) или webhook_url на свой сервер, который парсит Alertmanager payload и дергает Telegram API.
  # Простой вариант — готовый образ типа prometheus-telegram или скрипт: получает webhook от Alertmanager, форматирует и отправляет в Telegram.

  # --- Email (в global добавьте smtp_smarthost, smtp_from и при необходимости smtp_auth_*) ---
  # - name: email-ops
  #   email_configs:
  #     - to: 'ops@example.com'
  #       send_resolved: true
